-- =============================================
-- SCRIPT - MINIMARKET "DO√ëA MARTA"
-- PRY2204_Exp3_S8_FormaC
-- Incluye b√∫squedas avanzadas con LIKE, BETWEEN, IN
-- =============================================

-- ===========================
-- 1) LIMPIEZA INICIAL
-- ===========================
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE DETALLE_VENTA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE VENTA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE VENDEDOR CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE EMPLEADO CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE PRODUCTO CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE CATEGORIA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE MARCA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE PROVEEDOR CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE MEDIO_PAGO CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE REGION CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE AFP CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE SALUD CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE salud_seq';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE empleado_seq';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE seq_general';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

-- ===========================
-- 2) TABLAS FUERTES / LOOKUP
-- ===========================

-- REGION
CREATE TABLE REGION (
    id_region NUMBER PRIMARY KEY,
    nombre_region VARCHAR2(100) NOT NULL
);

-- AFP (IDENTITY START 210 INCREMENT 6)
CREATE TABLE AFP (
    id_afp NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 210 INCREMENT BY 6),
    nombre_afp VARCHAR2(100) NOT NULL,
    CONSTRAINT AFP_PK PRIMARY KEY (id_afp)
);

-- SALUD (ID via SEQUENCE)
CREATE TABLE SALUD (
    id_salud NUMBER PRIMARY KEY,
    nombre_salud VARCHAR2(100) NOT NULL
);

-- MEDIO_PAGO
CREATE TABLE MEDIO_PAGO (
    id_medio_pago NUMBER PRIMARY KEY,
    nombre_medio_pago VARCHAR2(50) NOT NULL
);

-- PROVEEDOR
CREATE TABLE PROVEEDOR (
    id_proveedor NUMBER PRIMARY KEY,
    nombre_proveedor VARCHAR2(150) NOT NULL,
    telefono VARCHAR2(20),
    correo VARCHAR2(150),
    direccion VARCHAR2(200),
    id_region NUMBER,
    CONSTRAINT PROVEEDOR_FK_REGION FOREIGN KEY (id_region) REFERENCES REGION(id_region)
);

-- MARCA
CREATE TABLE MARCA (
    id_marca NUMBER PRIMARY KEY,
    nombre_marca VARCHAR2(100) NOT NULL
);

-- CATEGORIA
CREATE TABLE CATEGORIA (
    id_categoria NUMBER PRIMARY KEY,
    nombre_categoria VARCHAR2(100) NOT NULL
);

-- ===========================
-- 3) TABLAS DEPENDIENTES
-- ===========================

-- PRODUCTO
CREATE TABLE PRODUCTO (
    id_producto NUMBER PRIMARY KEY,
    nombre_producto VARCHAR2(200) NOT NULL,
    id_marca NUMBER NOT NULL,
    id_categoria NUMBER,
    id_proveedor NUMBER,
    precio_unitario NUMBER(12,2) CHECK (precio_unitario >= 0),
    stock_actual NUMBER DEFAULT 0,
    stock_minimo NUMBER DEFAULT 0,
    CONSTRAINT PRODUCTO_FK_MARCA FOREIGN KEY (id_marca) REFERENCES MARCA(id_marca),
    CONSTRAINT PRODUCTO_FK_CATEGORIA FOREIGN KEY (id_categoria) REFERENCES CATEGORIA(id_categoria),
    CONSTRAINT PRODUCTO_FK_PROVEEDOR FOREIGN KEY (id_proveedor) REFERENCES PROVEEDOR(id_proveedor)
);

-- EMPLEADO
CREATE TABLE EMPLEADO (
    id_empleado NUMBER PRIMARY KEY,
    nombre VARCHAR2(100) NOT NULL,
    apellido_paterno VARCHAR2(100) NOT NULL,
    apellido_materno VARCHAR2(100),
    fecha_ingreso DATE,
    sueldo_base NUMBER(12,2) NOT NULL,
    bono_jefatura NUMBER(12,2),
    activo CHAR(1) DEFAULT 'S' CHECK (activo IN ('S','N')),
    id_afp NUMBER,
    id_salud NUMBER,
    id_region NUMBER,
    CONSTRAINT EMPLEADO_FK_AFP FOREIGN KEY (id_afp) REFERENCES AFP(id_afp),
    CONSTRAINT EMPLEADO_FK_SALUD FOREIGN KEY (id_salud) REFERENCES SALUD(id_salud),
    CONSTRAINT EMPLEADO_FK_REGION FOREIGN KEY (id_region) REFERENCES REGION(id_region)
);

-- VENDEDOR (asociado a EMPLEADO)
CREATE TABLE VENDEDOR (
    id_vendedor NUMBER PRIMARY KEY,
    id_empleado NUMBER UNIQUE,
    comision NUMBER(5,4) DEFAULT 0,
    CONSTRAINT VENDEDOR_FK_EMPLEADO FOREIGN KEY (id_empleado) REFERENCES EMPLEADO(id_empleado)
);

-- VENTA (IDENTITY START 5050 INCREMENT BY 3)
CREATE TABLE VENTA (
    id_venta NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 5050 INCREMENT BY 3),
    fecha_venta DATE DEFAULT SYSDATE,
    id_vendedor NUMBER,
    id_medio_pago NUMBER,
    total NUMBER(12,2),
    CONSTRAINT VENTA_PK PRIMARY KEY (id_venta),
    CONSTRAINT VENTA_FK_VENDEDOR FOREIGN KEY (id_vendedor) REFERENCES VENDEDOR(id_vendedor),
    CONSTRAINT VENTA_FK_MEDIOPAGO FOREIGN KEY (id_medio_pago) REFERENCES MEDIO_PAGO(id_medio_pago)
);

-- DETALLE_VENTA
CREATE TABLE DETALLE_VENTA (
    id_detalle NUMBER PRIMARY KEY,
    id_venta NUMBER,
    id_producto NUMBER,
    cantidad NUMBER,
    precio_unitario NUMBER(12,2),
    subtotal NUMBER(12,2),
    CONSTRAINT DETALLE_FK_VENTA FOREIGN KEY (id_venta) REFERENCES VENTA(id_venta),
    CONSTRAINT DETALLE_FK_PRODUCTO FOREIGN KEY (id_producto) REFERENCES PRODUCTO(id_producto)
);

-- ===========================
-- 4) SECUENCIAS REQUERIDAS
-- ===========================
-- SALUD: id_salud inicia en 2050 incrementa en 10
CREATE SEQUENCE salud_seq START WITH 2050 INCREMENT BY 10 NOCACHE NOCYCLE;

-- EMPLEADO: empieza en 750 y se incrementa en 3
CREATE SEQUENCE empleado_seq START WITH 750 INCREMENT BY 3 NOCACHE NOCYCLE;

-- Secuencia para ids gen√©ricos (productos, proveedores, etc.)
CREATE SEQUENCE seq_general START WITH 1000 INCREMENT BY 1 NOCACHE NOCYCLE;

-- ===========================
-- 5) ALTER TABLE: REGLAS DE NEGOCIO (CASO 2)
-- ===========================

-- 1) EMPLEADO: sueldo_base >= 400000
ALTER TABLE EMPLEADO
ADD CONSTRAINT EMPLEADO_CK_SUELDO_MIN CHECK (sueldo_base >= 400000);

-- 2) VENDEDOR: comision entre 0 y 0.25
ALTER TABLE VENDEDOR
ADD CONSTRAINT VENDEDOR_CK_COMISION CHECK (comision >= 0 AND comision <= 0.25);

-- 3) PRODUCTO: stock_minimo >= 3
ALTER TABLE PRODUCTO
ADD CONSTRAINT PRODUCTO_CK_STOCKMIN CHECK (stock_minimo >= 3);

-- 4) PROVEEDOR: unique correo
ALTER TABLE PROVEEDOR
ADD CONSTRAINT PROVEEDOR_UN_CORREO UNIQUE (correo);

-- 5) MARCA: nombre √∫nico
ALTER TABLE MARCA
ADD CONSTRAINT MARCA_UN_NOMBRE UNIQUE (nombre_marca);

-- 6) DETALLE_VENTA: cantidad > 0
ALTER TABLE DETALLE_VENTA
ADD CONSTRAINT DETALLE_CK_CANTIDAD CHECK (cantidad > 0);

-- ===========================
-- 6) POBLAMIENTO DE DATOS
-- ===========================

-- REGIONES
INSERT INTO REGION (id_region, nombre_region) VALUES (1, 'Regi√≥n Metropolitana');
INSERT INTO REGION (id_region, nombre_region) VALUES (2, 'Regi√≥n del Biob√≠o');
INSERT INTO REGION (id_region, nombre_region) VALUES (3, 'Regi√≥n de Valpara√≠so');
INSERT INTO REGION (id_region, nombre_region) VALUES (4, 'Regi√≥n de La Araucan√≠a');
INSERT INTO REGION (id_region, nombre_region) VALUES (5, 'Regi√≥n de Los Lagos');

-- AFP (IDENTITY)
INSERT INTO AFP (nombre_afp) VALUES ('AFP Habitat');
INSERT INTO AFP (nombre_afp) VALUES ('AFP Provida');
INSERT INTO AFP (nombre_afp) VALUES ('AFP Capital');
INSERT INTO AFP (nombre_afp) VALUES ('AFP Cuprum');
INSERT INTO AFP (nombre_afp) VALUES ('AFP Planvital');

-- SALUD (usar secuencia)
INSERT INTO SALUD (id_salud, nombre_salud) VALUES (salud_seq.NEXTVAL, 'Fonasa');
INSERT INTO SALUD (id_salud, nombre_salud) VALUES (salud_seq.NEXTVAL, 'Isapre Colmena');
INSERT INTO SALUD (id_salud, nombre_salud) VALUES (salud_seq.NEXTVAL, 'Isapre Banm√©dica');
INSERT INTO SALUD (id_salud, nombre_salud) VALUES (salud_seq.NEXTVAL, 'Isapre Consalud');
INSERT INTO SALUD (id_salud, nombre_salud) VALUES (salud_seq.NEXTVAL, 'Isapre Cruz Blanca');

-- MEDIO_PAGO
INSERT INTO MEDIO_PAGO (id_medio_pago, nombre_medio_pago) VALUES (1, 'Efectivo');
INSERT INTO MEDIO_PAGO (id_medio_pago, nombre_medio_pago) VALUES (2, 'Transferencia');
INSERT INTO MEDIO_PAGO (id_medio_pago, nombre_medio_pago) VALUES (3, 'Tarjeta D√©bito');
INSERT INTO MEDIO_PAGO (id_medio_pago, nombre_medio_pago) VALUES (4, 'Tarjeta Cr√©dito');

-- PROVEEDORES
INSERT INTO PROVEEDOR (id_proveedor, nombre_proveedor, telefono, correo, direccion, id_region)
VALUES (seq_general.NEXTVAL, 'Distribuidora Sur Ltda', '56912340001', 'ventas@distrosur.cl', 'Av. Sur 123', 2);

INSERT INTO PROVEEDOR (id_proveedor, nombre_proveedor, telefono, correo, direccion, id_region)
VALUES (seq_general.NEXTVAL, 'Proveedora Central', '5622345678', 'contacto@proveecentral.cl', 'Calle Central 45', 1);

INSERT INTO PROVEEDOR (id_proveedor, nombre_proveedor, telefono, correo, direccion, id_region)
VALUES (seq_general.NEXTVAL, 'Distribuciones Valle', '5639876543', 'ventas@distvalle.cl', 'Ruta 5', 3);

INSERT INTO PROVEEDOR (id_proveedor, nombre_proveedor, telefono, correo, direccion, id_region)
VALUES (seq_general.NEXTVAL, 'Alimentos del Sur', '5623456789', 'info@alimentossur.cl', 'Camino Rural 89', 4);

-- MARCAS
INSERT INTO MARCA (id_marca, nombre_marca) VALUES (100, 'LaLeche');
INSERT INTO MARCA (id_marca, nombre_marca) VALUES (101, 'SuperAbarrotes');
INSERT INTO MARCA (id_marca, nombre_marca) VALUES (102, 'BebidasPlus');
INSERT INTO MARCA (id_marca, nombre_marca) VALUES (103, 'LimpiezaTotal');
INSERT INTO MARCA (id_marca, nombre_marca) VALUES (104, 'NaturalFood');

-- CATEGORIAS
INSERT INTO CATEGORIA (id_categoria, nombre_categoria) VALUES (10, 'L√°cteos');
INSERT INTO CATEGORIA (id_categoria, nombre_categoria) VALUES (11, 'Bebidas');
INSERT INTO CATEGORIA (id_categoria, nombre_categoria) VALUES (12, 'Aseo');
INSERT INTO CATEGORIA (id_categoria, nombre_categoria) VALUES (13, 'Abarrotes');
INSERT INTO CATEGORIA (id_categoria, nombre_categoria) VALUES (14, 'Panader√≠a');

-- PRODUCTOS (con stock_minimo >=3 por restricci√≥n)
INSERT INTO PRODUCTO (id_producto, nombre_producto, id_marca, id_categoria, id_proveedor, precio_unitario, stock_actual, stock_minimo)
VALUES (2000, 'Leche Entera 1L', 100, 10, 1000, 800.00, 50, 5);

INSERT INTO PRODUCTO (id_producto, nombre_producto, id_marca, id_categoria, id_proveedor, precio_unitario, stock_actual, stock_minimo)
VALUES (2001, 'Cereal 500g', 101, 13, 1001, 1200.00, 20, 3);

INSERT INTO PRODUCTO (id_producto, nombre_producto, id_marca, id_categoria, id_proveedor, precio_unitario, stock_actual, stock_minimo)
VALUES (2002, 'Agua Mineral 1.5L', 102, 11, 1002, 700.00, 100, 10);

INSERT INTO PRODUCTO (id_producto, nombre_producto, id_marca, id_categoria, id_proveedor, precio_unitario, stock_actual, stock_minimo)
VALUES (2003, 'Jab√≥n en polvo 1kg', 103, 12, 1001, 2500.00, 15, 4);

INSERT INTO PRODUCTO (id_producto, nombre_producto, id_marca, id_categoria, id_proveedor, precio_unitario, stock_actual, stock_minimo)
VALUES (2004, 'Yogurt Natural', 100, 10, 1000, 450.00, 30, 5);

INSERT INTO PRODUCTO (id_producto, nombre_producto, id_marca, id_categoria, id_proveedor, precio_unitario, stock_actual, stock_minimo)
VALUES (2005, 'Jugo de Naranja 1L', 102, 11, 1002, 1200.00, 25, 6);

INSERT INTO PRODUCTO (id_producto, nombre_producto, id_marca, id_categoria, id_proveedor, precio_unitario, stock_actual, stock_minimo)
VALUES (2006, 'Detergente L√≠quido', 103, 12, 1003, 1800.00, 18, 4);

-- EMPLEADOS (usar empleado_seq)
INSERT INTO EMPLEADO (id_empleado, nombre, apellido_paterno, apellido_materno, fecha_ingreso, sueldo_base, bono_jefatura, activo, id_afp, id_salud, id_region)
VALUES (empleado_seq.NEXTVAL, 'Mar√≠a', 'Gonz√°lez', 'P√©rez', DATE '2018-03-15', 650000, 40000, 'S', 210, 2050, 1);

INSERT INTO EMPLEADO (id_empleado, nombre, apellido_paterno, apellido_materno, fecha_ingreso, sueldo_base, bono_jefatura, activo, id_afp, id_salud, id_region)
VALUES (empleado_seq.NEXTVAL, 'Juan', 'Rodr√≠guez', 'Lopez', DATE '2020-07-01', 480000, NULL, 'S', 216, 2060, 1);

INSERT INTO EMPLEADO (id_empleado, nombre, apellido_paterno, apellido_materno, fecha_ingreso, sueldo_base, bono_jefatura, activo, id_afp, id_salud, id_region)
VALUES (empleado_seq.NEXTVAL, 'Ana', 'Mart√≠nez', 'Soto', DATE '2016-11-20', 800000, 60000, 'S', 222, 2070, 2);

INSERT INTO EMPLEADO (id_empleado, nombre, apellido_paterno, apellido_materno, fecha_ingreso, sueldo_base, bono_jefatura, activo, id_afp, id_salud, id_region)
VALUES (empleado_seq.NEXTVAL, 'Pedro', 'Mu√±oz', 'Vega', DATE '2019-01-10', 550000, NULL, 'S', 210, 2050, 3);

INSERT INTO EMPLEADO (id_empleado, nombre, apellido_paterno, apellido_materno, fecha_ingreso, sueldo_base, bono_jefatura, activo, id_afp, id_salud, id_region)
VALUES (empleado_seq.NEXTVAL, 'Luisa', 'Herrera', 'Fuentes', DATE '2022-06-01', 420000, 20000, 'N', 216, 2060, 1);

INSERT INTO EMPLEADO (id_empleado, nombre, apellido_paterno, apellido_materno, fecha_ingreso, sueldo_base, bono_jefatura, activo, id_afp, id_salud, id_region)
VALUES (empleado_seq.NEXTVAL, 'Carlos', 'Silva', 'Mendoza', DATE '2017-05-15', 720000, 50000, 'S', 228, 2080, 1);

INSERT INTO EMPLEADO (id_empleado, nombre, apellido_paterno, apellido_materno, fecha_ingreso, sueldo_base, bono_jefatura, activo, id_afp, id_salud, id_region)
VALUES (empleado_seq.NEXTVAL, 'Elena', 'Castro', NULL, DATE '2021-09-10', 580000, NULL, 'S', 222, 2070, 2);

-- VENDEDOR (asociar algunos vendedores a empleados)
INSERT INTO VENDEDOR (id_vendedor, id_empleado, comision) VALUES (300, 750, 0.10);
INSERT INTO VENDEDOR (id_vendedor, id_empleado, comision) VALUES (301, 753, 0.05);
INSERT INTO VENDEDOR (id_vendedor, id_empleado, comision) VALUES (302, 756, 0.12);
INSERT INTO VENDEDOR (id_vendedor, id_empleado, comision) VALUES (303, 759, 0.08);

-- VENTAS (VENTA tiene identity)
INSERT INTO VENTA (fecha_venta, id_vendedor, id_medio_pago, total)
VALUES (DATE '2025-09-01', 300, 1, 1500.00);

INSERT INTO VENTA (fecha_venta, id_vendedor, id_medio_pago, total)
VALUES (DATE '2025-09-02', 301, 2, 4200.00);

INSERT INTO VENTA (fecha_venta, id_vendedor, id_medio_pago, total)
VALUES (DATE '2025-09-03', 302, 3, 2800.00);

INSERT INTO VENTA (fecha_venta, id_vendedor, id_medio_pago, total)
VALUES (DATE '2025-09-04', 300, 1, 3500.00);

-- DETALLES_VENTA
INSERT INTO DETALLE_VENTA (id_detalle, id_venta, id_producto, cantidad, precio_unitario, subtotal)
VALUES (4000, 5050, 2000, 2, 800.00, 1600.00);

INSERT INTO DETALLE_VENTA (id_detalle, id_venta, id_producto, cantidad, precio_unitario, subtotal)
VALUES (4001, 5053, 2002, 6, 700.00, 4200.00);

INSERT INTO DETALLE_VENTA (id_detalle, id_venta, id_producto, cantidad, precio_unitario, subtotal)
VALUES (4002, 5056, 2003, 1, 2500.00, 2500.00);

INSERT INTO DETALLE_VENTA (id_detalle, id_venta, id_producto, cantidad, precio_unitario, subtotal)
VALUES (4003, 5059, 2001, 3, 1200.00, 3600.00);

-- ===========================
-- 7) COMMIT
-- ===========================
COMMIT;

-- ===========================
-- 8) CONSULTAS SOLICITADAS (INFORMES)
-- ===========================

-- INFORME 1: Empleados activos con bono de jefatura
SELECT
    e.id_empleado AS IDENTIFICADOR,
    (e.nombre || ' ' || e.apellido_paterno || ' ' || NVL(e.apellido_materno,'')) AS "NOMBRE COMPLETO",
    e.sueldo_base AS SALARIO,
    e.bono_jefatura AS BONIFICACION,
    (e.sueldo_base + NVL(e.bono_jefatura, 0)) AS "SALARIO SIMULADO"
FROM EMPLEADO e
WHERE e.activo = 'S'
  AND e.bono_jefatura IS NOT NULL
ORDER BY "SALARIO SIMULADO" DESC,
         e.apellido_paterno DESC;

-- INFORME 2: Empleados con sueldo entre 550000 y 800000
SELECT
    (e.nombre || ' ' || e.apellido_paterno || ' ' || NVL(e.apellido_materno,'')) AS EMPLEADO,
    e.sueldo_base AS SUELDO,
    '8%' AS "POSIBLE AUMENTO",
    ROUND(e.sueldo_base * 1.08, 0) AS "SALARIO SIMULADO"
FROM EMPLEADO e
WHERE e.sueldo_base BETWEEN 550000 AND 800000
ORDER BY e.sueldo_base ASC;

-- ===========================
-- 9) B√öSQUEDAS AVANZADAS CON LIKE, BETWEEN, IN
-- ===========================

-- B√öSQUEDA 1: Productos por patr√≥n de nombre (LIKE)
SELECT 
    p.id_producto AS "ID",
    p.nombre_producto AS "PRODUCTO",
    m.nombre_marca AS "MARCA",
    c.nombre_categoria AS "CATEGOR√çA",
    p.precio_unitario AS "PRECIO",
    p.stock_actual AS "STOCK"
FROM PRODUCTO p
INNER JOIN MARCA m ON p.id_marca = m.id_marca
INNER JOIN CATEGORIA c ON p.id_categoria = c.id_categoria
WHERE p.nombre_producto LIKE '%Leche%' 
   OR p.nombre_producto LIKE '%Jugo%'
   OR p.nombre_producto LIKE '%Agua%'
ORDER BY p.stock_actual DESC;

-- B√öSQUEDA 2: Empleados por rango de fechas y sueldos (BETWEEN)
SELECT 
    id_empleado AS "ID",
    nombre || ' ' || apellido_paterno AS "NOMBRE",
    fecha_ingreso AS "FECHA INGRESO",
    sueldo_base AS "SUELDO",
    CASE 
        WHEN fecha_ingreso BETWEEN DATE '2018-01-01' AND DATE '2019-12-31' THEN 'Antiguo'
        WHEN fecha_ingreso BETWEEN DATE '2020-01-01' AND DATE '2021-12-31' THEN 'Medio'
        ELSE 'Nuevo'
    END AS "ANTIG√úEDAD"
FROM EMPLEADO
WHERE fecha_ingreso BETWEEN DATE '2018-01-01' AND DATE '2022-12-31'
  AND sueldo_base BETWEEN 500000 AND 750000
ORDER BY fecha_ingreso ASC;

-- B√öSQUEDA 3: Productos con stock cr√≠tico (operadores de comparaci√≥n)
SELECT 
    nombre_producto AS "PRODUCTO",
    stock_actual AS "STOCK ACTUAL",
    stock_minimo AS "STOCK M√çNIMO",
    CASE 
        WHEN stock_actual <= stock_minimo THEN 'üü• CR√çTICO'
        WHEN stock_actual <= stock_minimo * 1.5 THEN 'üü® BAJO'
        ELSE 'üü© NORMAL'
    END AS "ESTADO INVENTARIO"
FROM PRODUCTO
WHERE stock_actual <= stock_minimo * 2
ORDER BY stock_actual ASC;

-- B√öSQUEDA 4: Ventas por vendedor espec√≠fico (IN)
SELECT 
    v.id_venta AS "VENTA",
    TO_CHAR(v.fecha_venta, 'DD/MM/YYYY') AS "FECHA",
    e.nombre || ' ' || e.apellido_paterno AS "VENDEDOR",
    mp.nombre_medio_pago AS "MEDIO PAGO",
    v.total AS "TOTAL",
    ROUND(vd.comision * v.total, 2) AS "COMISI√ìN"
FROM VENTA v
INNER JOIN VENDEDOR vd ON v.id_vendedor = vd.id_vendedor
INNER JOIN EMPLEADO e ON vd.id_empleado = e.id_empleado
INNER JOIN MEDIO_PAGO mp ON v.id_medio_pago = mp.id_medio_pago
WHERE vd.id_vendedor IN (300, 302)  -- Vendedores espec√≠ficos
ORDER BY v.total DESC;

-- B√öSQUEDA 5: Proveedores por regiones espec√≠ficas (IN con texto)
SELECT 
    p.nombre_proveedor AS "PROVEEDOR",
    r.nombre_region AS "REGI√ìN",
    p.telefono AS "TEL√âFONO",
    p.correo AS "EMAIL"
FROM PROVEEDOR p
INNER JOIN REGION r ON p.id_region = r.id_region
WHERE r.nombre_region IN ('Regi√≥n Metropolitana', 'Regi√≥n de Valpara√≠so')
ORDER BY r.nombre_region, p.nombre_proveedor;

-- B√öSQUEDA 6: Empleados con patrones en nombres y apellidos (LIKE m√∫ltiple)
SELECT 
    id_empleado AS "ID",
    nombre || ' ' || apellido_paterno || ' ' || NVL(apellido_materno, '') AS "NOMBRE COMPLETO",
    sueldo_base AS "SUELDO",
    fecha_ingreso AS "INGRESO"
FROM EMPLEADO
WHERE (nombre LIKE 'M%' OR nombre LIKE 'A%')  -- Nombres que empiezan con M o A
   AND apellido_paterno LIKE '%z'             -- Apellidos que terminan con z
   AND activo = 'S'
ORDER BY nombre, apellido_paterno;

-- B√öSQUEDA 7: Productos por categor√≠a y rango de precios (BETWEEN y LIKE)
SELECT 
    c.nombre_categoria AS "CATEGOR√çA",
    p.nombre_producto AS "PRODUCTO", 
    m.nombre_marca AS "MARCA",
    p.precio_unitario AS "PRECIO",
    p.stock_actual AS "STOCK",
    CASE
        WHEN p.precio_unitario < 1000 THEN 'ECON√ìMICO'
        WHEN p.precio_unitario BETWEEN 1000 AND 2000 THEN 'MEDIO'
        ELSE 'PREMIUM'
    END AS "SEGMENTO"
FROM PRODUCTO p
INNER JOIN CATEGORIA c ON p.id_categoria = c.id_categoria
INNER JOIN MARCA m ON p.id_marca = m.id_marca
WHERE c.nombre_categoria LIKE '%L√°cteos%'
   AND p.precio_unitario BETWEEN 400 AND 1500
ORDER BY p.precio_unitario DESC;

-- B√öSQUEDA 8: An√°lisis de ventas por per√≠odo (BETWEEN con fechas)
SELECT 
    TO_CHAR(v.fecha_venta, 'MM/YYYY') AS "MES",
    COUNT(*) AS "TOTAL VENTAS",
    SUM(v.total) AS "INGRESOS TOTALES",
    ROUND(AVG(v.total), 2) AS "VENTA PROMEDIO",
    MAX(v.total) AS "VENTA M√ÅXIMA",
    MIN(v.total) AS "VENTA M√çNIMA"
FROM VENTA v
WHERE v.fecha_venta BETWEEN DATE '2025-09-01' AND DATE '2025-09-30'
GROUP BY TO_CHAR(v.fecha_venta, 'MM/YYYY')
ORDER BY "MES" DESC;

-- B√öSQUEDA 9: Empleados por AFP espec√≠ficas (IN con n√∫meros)
SELECT 
    e.nombre || ' ' || e.apellido_paterno AS "EMPLEADO",
    a.nombre_afp AS "AFP",
    s.nombre_salud AS "SALUD",
    e.sueldo_base AS "SUELDO BASE",
    e.bono_jefatura AS "BONO"
FROM EMPLEADO e
INNER JOIN AFP a ON e.id_afp = a.id_afp
INNER JOIN SALUD s ON e.id_salud = s.id_salud
WHERE a.id_afp IN (210, 222)  -- AFP Habitat y AFP Capital
  AND e.activo = 'S'
ORDER BY a.nombre_afp, e.sueldo_base DESC;

-- B√öSQUEDA 10: B√∫squeda compleja con m√∫ltiples condiciones
SELECT 
    p.nombre_producto AS "PRODUCTO",
    pr.nombre_proveedor AS "PROVEEDOR",
    r.nombre_region AS "REGI√ìN PROVEEDOR",
    p.precio_unitario AS "PRECIO",
    p.stock_actual AS "STOCK"
FROM PRODUCTO p
INNER JOIN PROVEEDOR pr ON p.id_proveedor = pr.id_proveedor
INNER JOIN REGION r ON pr.id_region = r.id_region
WHERE (p.nombre_producto LIKE '%Leche%' OR p.nombre_producto LIKE '%Yogurt%')
  AND p.precio_unitario BETWEEN 400 AND 1000
  AND p.stock_actual > 10
  AND r.id_region IN (1, 2)
ORDER BY p.precio_unitario ASC;

-- ===========================
-- 10) CONSULTAS DE VERIFICACI√ìN
-- ===========================

-- Verificar que las restricciones se crearon correctamente
SELECT constraint_name, constraint_type, table_name, status
FROM user_constraints 
WHERE table_name IN ('EMPLEADO', 'PRODUCTO', 'VENDEDOR', 'DETALLE_VENTA')
ORDER BY table_name, constraint_type;

-- Verificar el poblamiento de datos
SELECT 'REGION' AS tabla, COUNT(*) AS cantidad FROM REGION
UNION ALL
SELECT 'EMPLEADO', COUNT(*) FROM EMPLEADO
UNION ALL
SELECT 'PRODUCTO', COUNT(*) FROM PRODUCTO
UNION ALL
SELECT 'VENTA', COUNT(*) FROM VENTA
UNION ALL
SELECT 'PROVEEDOR', COUNT(*) FROM PROVEEDOR;